#!/bin/sh

set -eu

if [ $# -ne 1 ]; then
  echo "Usage: $(basename "${0}") <question>"
  echo
  echo 'Example:'
  echo '    $ if confirm "Delete everything?"; then echo rm -rf; fi'
  echo '    Delete everything? [y/N] y'
  echo '    rm -rf'
  exit 1
fi


readonly stdin='0'
is_tty() {
  test -t ${1}
}
read_single_char() {
  if is_tty stdin; then
    readonly tty_state="$(stty -g)"
    stty -icanon min 1 time 0
  fi
  dd bs=1 count=1 2>/dev/null
  if is_tty stdin; then
    stty "${tty_state}"
  fi
}

printf '%s [y/N] ' "${1}"
ok="$(read_char)"
readonly ok

# If they pressed anything but Enter, do a newline.
if [ "${ok}" ]; then
  echo
fi

test "${ok}" = 'y' -o "${ok}" = 'Y'
